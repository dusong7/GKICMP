function refresh(n, t) { $.ajax({ url: n, cache: !1, type: "GET", success: function (n) { t.html(n) }, error: function () { layer.msg("刷新数据失败") } }) } function addnewitem(n, t, i, r, u) { $("<div id='addnewitem'>加载中，请稍候<\/div>").dialog({ title: n, modal: !0, width: "50%", close: function () { $(this).dialog("destroy"); refresh(r, u) } }); $.ajax({ url: t, data: i, cache: !1, success: function (n) { $("#addnewitem").html(n) }, error: function () { layer.alert("打开错误") } }) } function Print(n) { var t = $("body").clone(); $("body").html(n.html()); window.print(); $("body").html(t.html()); window.location.reload() } $("img").dblclick(function () { var n = this, t; layer.msg("正在尝试识别人脸", 10, 5); $.ajax({ url: "/Face/FaceDetect", data: { filename: $(n).attr("src") }, cache: !1, datatype: "json", success: function (i) { t = i; $.each(i, function (t, i) { layer.closeAll(); var r = "<div class='faces' title='这是谁？' id='" + t + "' style='border:1px #F00 solid;position:absolute;'>" + t + "<\/div>"; $("body").append(r); $(".faces[id=" + t + "]").css("width", i.Width * $(n).width() + "px"); $(".faces[id=" + t + "]").css("height", i.Height * $(n).height() + "px"); $(".faces[id=" + t + "]").css("top", $(n).offset().top + i.Y * $(n).height() + "px"); $(".faces[id=" + t + "]").css("left", $(n).offset().left + i.X * $(n).width() + "px") }); layer.closeAll(); $(".faces").click(function () { var u = [], r = this; $.each(i, function (n, t) { n == $(r).attr("id") && $.each(t.candidate, function (n, t) { u.push(t.tag) }) }); $("#suggest").remove(); $("body").append($('<div id="suggest" style="background-color:#FFF;position:absolute;"><\/div>').html("<input type='text' style='width:80px;' id='keymember'><br>" + u.join("<br>")).css("left", $(r).position().left + $(r).width() + 2).css("top", $(r).position().top)); $("#keymember").autocomplete({ source: "/Users/GetMember", select: function (i, u) { $.ajax({ url: "/Face/AddFaceToPerson", data: { faceid: t[$(r).attr("id")].face_id, username: u.item.value, imgurl: $(n).attr("src"), tmp: Math.random() }, success: function () { layer.msg("谢谢你的识别！") }, error: function () { layer.msg("尝试识别时发生错误") } }) } }) }) }, error: function () { layer.msg("分析错误") } }) }); $(".linkimg img").hover(function () { $(this).slideDown("slow") }); $(".newmastermail").click(function () { $("<div id='newmail'>加载中，请稍候……<\/div>").dialog({ title: "校长信箱", modal: !0, show: "slide", hide: "slide", width: "50%", close: function () { $(this).dialog("destroy") } }); $.get("/MasterMail/Create?tmp=" + Math.random(), function (n) { $("#newmail").html(n) }) }); $(".changepassword").button().click(function () { window.location.href = "/Account/Changepassword" }); var MiniTool = [["emotion", "forecolor", ]]; $("#addss").click(function () { $("#ss").remove(); $("#ss").length <= 0 && $("<div style='width:100%;display:none;' id='ss'>加载中……<\/div>").insertAfter($(this).parent()).slideDown(100).load("/GuestBook/Create") }); $("body").on("click", ".ajaxsave", function () { var n = this; $(n).parent().valid() ? (layer.load("请稍候……"), $(n).parent().ajaxSubmit({ type: "POST", success: function (t) { if (layer.closeAll(), t.result == !0) { layer.alert(t.msg, Domain, function () { if (typeof $(n).attr("after") != "undefined") try { eval($(n).attr("after")) } catch (e) { window.location.reload() } else { if (layer.load("请稍候……"), $(n).attr("returnurl") == null) { window.location.reload(!0); return } window.location.href = $(n).attr("returnurl") } }); return } layer.alert(t.msg) }, error: function () { layer.alert("操作错误") } })) : layer.alert("请填写完整再提交") }).on("click", ".delete", function () { if (typeof $(this).attr("id") == "undefined" || $(this).attr("id") == "") { layer.alert("请选择要删除的内容"); return } var n = this; layer.confirm(typeof $(n).attr("tip") != "undefined" ? $(n).attr("tip") : "删除是不可恢复的！你要继续么？", function (t) { t && $.ajax({ url: typeof $(n).attr("url") == "undefined" ? "delete" : $(n).attr("url"), data: { id: $(n).attr("id") }, cache: !1, type: "post", success: function (t) { if (t.result == !0) { layer.alert(t.msg, 1, function () { if (typeof $(n).attr("after") != "undefined") try { eval($(n).attr("after")) } catch (e) { window.location.reload() } else window.location.reload(!0) }); return } layer.alert(t.msg) }, error: function () { layer.alert("提交时错误") } }) }) }).on("click", ".CreateDianPing,.bless", function () { $("#CreateDianPing").remove(); $("#CreateDianPing").length <= 0 && $("<div id='CreateDianPing'>加载中<\/div>").insertAfter($(this)); $("#CreateDianPing").load("/DianPing/Create?username=" + this.id) }).on("click", ".ReplyDianPing", function () { $("#ReplyDianPing").remove(); $("#ReplyDianPing").length <= 0 && $("<div id='ReplyDianPing'>加载中<\/div>").insertAfter($(this)); $("#ReplyDianPing").load("/DianPing/Create?username=" + $(this).data("username") + "&id=" + this.id) }); $(".commondate").datepicker({ monthNames: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"], dayNames: ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"], dayNamesShort: ["周日", "周一", "周二", "周三", "周四", "周五", "周六"], dayNamesMin: ["日", "一", "二", "三", "四", "五", "六"] }).css("width", "100px"); $(".SearchButton").button().click(function () { if ($("#keyword").val() == "") return layer.tips("输入内容后再搜索", this, { style: ["background-color:#000; color:#fff", "#000"], guide: 2, time: 2 }), !1; layer.load("正在搜索……"); $(this).parent().submit() }); $(".tabs").tabs({ event: "mouseover" }); $(".textbutton").button()